


## Основные команды Vagrant
- vagrant up - запустить или создать виртуальную машину 
- vagrant reload - перезагрузка виртуальной машины vagrant halt  - останавливает виртуальную машину 
- vagrant destroy  - удаляет виртуальную машину 
- vagrant suspend  - "замораживает" виртуальную машину 
- vagrant global-status  - выводит список всех ранее созданных виртуальных машин в хост-системе 
- vagrant status - посмотреть статус виртуальной машины Отображение созданной виртуальной машины в VirtualBox Vagrant 14 
- vagrant ssh  - подключается к виртуальной машине по SSH vagrant - список всех доступных команд

Так же можно с виртуальными машинами Vagrant работать и из командной строки. В том же окне командной строки выполняем команду: 

```
vagrant ssh 
```

Пароль по умолчанию: vagrant. Имя пользователя: vagrant. Потому вводим здесь пароль: vagrant.
----------------------------------------------------------------------–

Vagrant Vagrant — это инструмент командной строки для создания виртуальных машин и управления ими. 
По умолчанию Vagrant может подготавливать машины поверх VirtualBox, Hyper-V и Docker. Другие поставщики, такие как Libvirt (KVM), VMware и AWS, могут быть установлены через систему плагинов Vagrant. 
Vagrant обычно используется разработчиками для создания среды разработки, которая работает в нескольких операционных системах. Vagrant помогает установить и настроить виртуальную машину на основе конфигурационного файла - **Vagrantfile**. 
Vagrant работает с виртуальными машинами, а значит для виртуализации ему необходим какой-либо "провайдер". И для нашего примера подойдет VirtualBox. 
Для Vagrant существуют готовые образы операционных систем, называемых «коробками » (boxes). Коробка — это, по сути, просто образ уже установленной и настроенной операционной системы, на основании которого строится виртуальная машина. Часто авторы коробок собирают их для поддержки в разных гипервизорах (приложениях для работы с виртуальными машинами). 
Аналог Docker Hub только для образов ОС (коробок) - является Vagrant Cloud: https://app.vagrantup.com/boxes/search. 
Виртуальная машина, управляемая Vagrant-ом, представляет собой полноценный виртуальный сервер, на котором установлена операционная система и весь необходимый набор приложений и служб. 
Чтобы развернуть коробку в виртуальную машину, нужен файл конфигурации, в котором описаны все параметры развертывания. Такой файл называется Vagrantfile и написан он с применением синтаксиса Ruby (на котором и написан Vagrant).

![[Pasted image 20241106153311.png]]

Также ничего не мешает использовать Vargant вместе с Docker. Мы можем использовать Vagrant — ради возможности создавать изолированную среду разработки, основанную на виртуальной машине со всеми необходимыми сервисами, которая должна будет воспроизвести реальную рабочую среду. Другими словами, для быстрого и эффективного запуска Docker.


![[Pasted image 20241106153352.png]]
Кроме того, Vagrant часто применяют в связке с таким инструментом как Ansible.

![[Pasted image 20241106153417.png]]

## Установка Vagrant в Windows 10
Для установки Vagrant необходимо скачать пакет с файлами для установки, который доступен по ссылке: https://releases.hashicorp.com/vagrant/. В появившемся окне выбираем последнюю версию установщика. Для установки на Windows выбираем файл с расширением .msi. После скачивания запускаем файл vagrant_x.x.x_x86_64.msi. 

Изменения в переменные среды мы будем вносить при помощи командной строки, а конкретно в переменную PATH мы будем добавлять путь до каталога, куда установлен Vagrant (в нашем случаем это: C:\HashiCorp\Vagrant\bin). Вызываем командную строку следующим образом: 1. нажимаем на клавиатуре клавиши Ctrl+R для вызова окна "Выполнить".2. В появившемся окне набираем команду: cmd3. Нажимаем кнопку ОК: В окне командной строки добавляем следующую команду:

```
set PATH=%PATH%;путь_до_папки_с_vagrant\Vagrant\bin
```

В моём случае:
```
set PATH=%PATH%;D:\Vagrant\bin
```

Теперь для проверки того, удалось ли нам прописать путь к Vagrant в переменные среду, в этом же окне командной строки набираем команду:
```
vagrant -v
```

## Установка Vagrant в Linux (Ubuntu 20.04)

```
sudo apt-get update 
sudo apt-get install virtualbox
```

Пакет Vagrant, доступный в репозиториях Ubuntu, не обновляется регулярно. Его следует скачивать с официального сайта Vagrant.
```
curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -
```

```
sudo apt-add-repository "deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main"
```

```
sudo apt-get update && sudo apt-get install vagrant
```

## Создание виртуальной машины в Vagrant
Для создания виртуальной машины для начала создадим отдельную папку, например, VagrantVM и перейдём в неё:

```
mkdir VagrantVM 
cd VagrantVM
```

Команда  vagrant init создает файл Vagrantfile в текущей директории.
Перед созданием виртуальной машины добавим еще несколько настроек в Vagrantfile:




- config.vm.box  — базовый образ. В нашем случае Ubuntu 20.04 config.vm.provider  — система виртуализации. Доступные провайдеры: VirtualBox, VMware, Hyper-V, Docker и др. 
- **config.vm.hostname**  — имя хоста. 
- config.vm.synced_folder  — синхронизация папок. Первым параметром передается путь хостовой (основной) машины, вторым параметром передается путь гостевой (виртуальной машины) 
- config.vm.network  — настройки сети. Мы настроили перенаправление портов и статический ip-адрес, к которому привяжем домен. Доступны и другие настройки. 
- config.vm.provision  — служит для автоматической установки и настройки программного обеспечения. Мы использовали самый простой способ Shellскрипт, также доступны другие: Ansible, Chef, Puppet и др.

Полный список опций для настройки представлен в официальной документации: https://www.vagrantup.com/docs/vagrantfile/machine_settings 
Для удобства настройка системы вынесена в отдельный файл  provision.sh Во время установки Vagrant запустит его внутри созданной виртуальной машины. 
Содержимое файла  provision.sh :

```
apt-get update 
apt-get -y upgrade 

apt-add-repository ppa:ondrej/php -y 
apt-get update 
apt-get install -y software-properties-common curl zip 

apt-get install -y php7.2-cli php7.2-fpm \ 
php7.2-pgsql php7.2-sqlite3 php7.2-gd \ 
```

Создаем виртуальную машину. В первый раз процесс займет больше времени, Vagrant должен скачать образ с операционной системой. Выполните команду, которая создаст и запустит виртуальную машину:

```
vagrant up
```
